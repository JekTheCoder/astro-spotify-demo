---
import { allPlaylists, songs } from "@/lib/data";
import AppPage from "../../layouts/AppPage.astro";
import { Image } from "astro:assets";
import PlaylistButton from "@/components/PlaylistButton";
import Play from "@/icons/Play.astro";
import Time from "@/icons/Time.astro";

const { id } = Astro.params;
const playlist = allPlaylists.find((playlist) => playlist.id === id);

if (!playlist) {
  Astro.redirect("/not-found");
  return;
}

const playlistSongs = songs.filter((song) => song.albumId === playlist.albumId);
const { title, cover, artists, color } = playlist;

const joinedArtists = artists.join(", ");
---

<AppPage>
  <main
    class="rounded-lg overflow-hidden grid grid-rows-[auto_1fr]"
    transition:name=`playlist-${id}-box`
  >
    <header class="relative pb-6">
      <nav class="p-10"></nav>

      <div class="playlist-header relative px-6 grid gap-x-5 z-10">
        <div class="flex items-end">
          <picture class="shadow-black shadow-2xl">
            <Image
              class="object-contain w-full aspect-square rounded-md"
              src={cover}
              alt={`Cover of ${title} by ${joinedArtists}`}
              width={154}
              height={154}
              loading="eager"
              transition:name=`playlist-${id}-image`
            />
          </picture>
        </div>

        <div class="flex flex-col justify-end">
          <h2
            class="text-3xl lg:text-5xl xl:text-6xl 2xl:text-8xl font-bold text-white"
            transition:name=`playlist-${id}-name`
          >
            {title}
          </h2>

          <span>{joinedArtists}</span>
        </div>
      </div>

      <div
        class="absolute inset-0 bg-color"
        style={`--bg-color: ${color.accent}`}
      >
      </div>
    </header>

    <section class="bg-zinc-900 p-4">
      <div class="text-black relative z-10 mb-8">
        <PlaylistButton client:load playlistId={playlist.id} />
      </div>

      <table class="w-full text-[#a7a7a7] font-normal text-left relative z-20">
        <thead class="border-b border-glass">
          <tr>
            <th class="text-center"><p class="pr-2">#</p></th>
            <th>Artist</th>
            <th>Album</th>
            <th>
              <div class="flex justify-center">
                <Time />
              </div>
            </th>
          </tr>
        </thead>

        <tbody>
          {
            playlistSongs.map((song, i) => (
              <tr class="group">
                <td>
                  <div class="w-6 flex justify-end">
                    <p class="group-hover:hidden pr-2">{i + 1}</p>

                    <Play class="hidden text-white group-hover:block w-6 h-6" />
                  </div>
                </td>
                <td>
                  <div class="grid grid-cols-[auto_1fr] gap-x-4">
                    <picture class="aspect-square h-10">
                      <img
                        class="w-full h-full rounded-md"
                        src={song.image}
                        alt=""
                      />
                    </picture>

                    <div class="flex flex-col">
                      <span class="text-white font-bold">{song.title}</span>
                      <span>{song.artists.join(",")}</span>
                    </div>
                  </div>
                </td>
                <td>{song.album}</td>
                <td class="text-center">{song.duration}</td>
              </tr>
            ))
          }
        </tbody>
      </table>
    </section>
  </main>
</AppPage>

<style>
  .playlist-header {
    grid-template-columns: minmax(8rem, 2fr) 9fr;
  }

  .bg-color {
    height: 180%;
    background-image: linear-gradient(to top, transparent, var(--bg-color));
  }

  td {
    @apply truncate py-2 group-hover:bg-glass;
  }

  td:first-child {
    @apply rounded-tl-lg rounded-bl-lg;
  }

  td:last-child {
    @apply rounded-tr-lg rounded-br-lg pr-4;
  }

  th {
    @apply pb-2;
  }

  td:first-child,
  th:first-child {
    @apply pl-4;
  }

  td:last-child,
  th:last-child {
    @apply pr-4;
  }

  td,
  th {
    font-size: 16px;
    line-height: normal;
  }
</style>
